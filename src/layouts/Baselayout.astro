---
// src/layouts/Baselayout.astro
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
// 引入刚才做好的组件
import BackgroundCollage from '../components/BackgroundCollage.astro';
import { ViewTransitions } from 'astro:transitions';

const { title, description } = Astro.props;
const { pathname } = Astro.url;

// 简单判断：如果路径包含 'works'，就是暖色模式，否则是冷色
// 你可以根据实际路由调整逻辑，比如 '/works' 或 '/projects'
const isWorksPage = pathname.includes('/works');
const currentTheme = isWorksPage ? 'warm' : 'cool';
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <ViewTransitions />
  </head>

  <body>
    <BackgroundCollage theme={currentTheme} transition:persist />

    <div class="color-grade-overlay" data-theme={currentTheme}></div>

    <div class="grain-overlay"></div>

    <div id="custom-cursor"></div>

    <Header transition:persist />

    <main transition:animate="fade">
      <slot />
    </main>

    <Footer />

    <script>
       // ...cursor 脚本保持不变...
       const initCursor = () => {
        const cursor = document.getElementById('custom-cursor');
        if (!cursor) return;
        window.addEventListener('mousemove', (e) => {
          cursor.style.transform = `translate(${e.clientX}px, ${e.clientY}px)`;
        });
      };
      document.addEventListener('astro:page-load', initCursor);
    </script>
  </body>
</html>

<style is:global>
  /* 全局变量定义 */
  :root {
    --c-nav-text: #003366;
    --font-serif: "Times New Roman", serif;

    /* 冷色系 (首页) */
    --grad-cool-top: rgba(165, 216, 255, 0.4);
    --grad-cool-bottom: rgba(19, 102, 183, 0.7);
    --bg-cool: #1366B7;

    /* 暖色系 (Works) - 类似于胶片感 */
    --grad-warm-top: rgba(255, 220, 180, 0.4); /* 暖黄 */
    --grad-warm-bottom: rgba(180, 90, 40, 0.7); /* 铁锈红/褐 */
    --bg-warm: #8B3A18;
  }

  html {
    background-color: var(--bg-cool);
    min-height: 100vh;
    font-family: "Times New Roman", serif;
    cursor: none;
    overflow-x: hidden;
    /* 背景色过渡 */
    transition: background-color 1.2s ease;
  }

  /* 颜色遮罩层 */
  .color-grade-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
    mix-blend-mode: multiply;

    /* 默认冷色渐变 */
    background: linear-gradient(to bottom, var(--grad-cool-top) 0%, var(--grad-cool-bottom) 100%);

    /* 渐变过渡 */
    transition: background 1.2s ease;
  }

  /* 当 overlay 处于 warm 状态时切换渐变 */
  .color-grade-overlay[data-theme='warm'] {
    background: linear-gradient(to bottom, var(--grad-warm-top) 0%, var(--grad-warm-bottom) 100%);
  }

  /* 配合修改 html 背景底色，防止渐变透明处漏出蓝色 */
  body:has(.color-grade-overlay[data-theme='warm']) {
    /* 这里通过 has 选择器或者直接 JS 控制 html 样式也可以，
       或者依靠 overlay 覆盖即可。 */
  }

  /* ...其余样式不变... */
</style>