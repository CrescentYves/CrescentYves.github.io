---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import BackgroundCollage from '../components/BackgroundCollage.astro'; // <--- 引入新组件
import { ViewTransitions } from 'astro:transitions';

const { title, description } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <ViewTransitions />
  </head>

  <body>
    <!-- 1. 最底层：风格化拼贴背景 -->
    <BackgroundCollage />

    <!-- 2. 噪点层 (保留，放在拼贴之上，增加胶片质感) -->
    <div class="grain-overlay"></div>

    <!-- 3. 光标和微光 (保留) -->
    <div id="ambient-glow"></div>
    <div id="custom-cursor"></div>

    <Header transition:persist />

    <main transition:animate="slide">
      <slot />
    </main>

    <Footer />

    <!-- 这里保留你之前添加的 script 代码 (光标交互) -->
    <script>
       // ... (保留原有的光标 JS 代码)
       // 注意：如果你之前的 JS 代码很长，建议移到 /src/scripts/cursor.js 然后用 <script src={...} /> 引入
       function initCursor() {
          const glow = document.getElementById('ambient-glow');
          const cursor = document.getElementById('custom-cursor');
          // ... 以及后续的逻辑

           document.addEventListener('mousemove', (e) => {
              const { clientX, clientY } = e;
              if (glow) {
                // 修改：微光不要太亮，因为背景已经是图片了
                glow.animate({ left: `${clientX}px`, top: `${clientY}px` }, { duration: 3000, fill: "forwards" });
              }
              if (cursor) {
                cursor.style.transform = `translate(${clientX}px, ${clientY}px)`;
              }
           });

           // ... 链接 hover 逻辑
       }
       document.addEventListener('astro:page-load', initCursor);
    </script>
  </body>
</html>

<style is:global>
  :root {
    --c-blue: #002fa7;
    --c-yellow: #fff100;
    --c-text: #ffffff;
    --cursor-size: 20px;
  }

  html {
    cursor: none;
    background-color: #000; /* 背景底色设为黑，防止图片没加载时太亮 */
    /* background: linear-gradient(...)  <-- 删掉这一行，因为我们有拼贴背景了 */

    min-height: 100vh;
    color: var(--c-text);
    font-family: "Times New Roman", serif;
    overflow-x: hidden;
  }

  /* ... 保留其他全局样式 (a, main, etc.) ... */

  /* 调整噪点层 */
  .grain-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none;
    z-index: 1; /* 噪点在图片之上 */
    opacity: 0.15; /* 可以稍微调高一点，增加《迷失东京》那种颗粒感 */
    background-image: url("data:image/svg+xml,..."); /* 保留你的噪点SVG */
    mix-blend-mode: overlay;
  }

  /* 调整微光层 (Ambient Glow) */
  #ambient-glow {
    /* ...保留原有样式... */
    /* 建议：把混合模式改为 soft-light 或 overlay，避免把背景图片照得太白 */
    mix-blend-mode: screen;
    opacity: 0.4; /* 调低不透明度 */
  }

  /* ... 保留光标样式 ... */
</style>