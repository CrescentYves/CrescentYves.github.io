---
// components/BackgroundCollage.astro
// (HTML 和 JS 逻辑部分保持原样，直接向下滚动到 style 部分)
const { theme = 'cool' } = Astro.props;
const homeImages = Array.from({ length: 6 }, (_, i) => `/images/work${i + 1}.jpg`);
const worksImages = Array.from({ length: 6 }, (_, i) => `/images/work${i + 7}.jpg`);
---

<div id="collage-wrapper" class="collage-wrapper" data-active-theme={theme} transition:persist>
  <div class="image-group group-cool">
    {homeImages.map((src, index) => (
      <div class={`img-item item-${index + 1}`}>
        <img src={src} alt="" />
      </div>
    ))}
  </div>

  <div class="image-group group-warm">
    {worksImages.map((src, index) => (
      <div class={`img-item item-${index + 1}`}>
        <img src={src} alt="" />
      </div>
    ))}
  </div>

  <div class="internal-overlay"></div>
</div>

<script>
  // (JS 保持原样，监听路由切换主题)
  document.addEventListener('astro:page-load', () => {
    const wrapper = document.getElementById('collage-wrapper');
    if (wrapper) {
      const isWorks = window.location.pathname.includes('/works');
      wrapper.setAttribute('data-active-theme', isWorks ? 'warm' : 'cool');
    }
  });
</script>

<style>
  .collage-wrapper {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
    overflow: hidden;
    pointer-events: none;
    background-color: transparent; /* 背景色由 BaseLayout 控制 */
  }

  /* --- 核心布局：CSS Grid --- */
  .image-group {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    padding: 4vh 4vw; /* 给屏幕四周留出边距，像画框一样 */
    box-sizing: border-box;

    /* 定义网格：3列 x 2行 = 6个位置 */
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 3列等宽 */
    grid-template-rows: repeat(2, 1fr);    /* 2行等高 */
    gap: 3vw; /* 图片之间的间隙 */

    /* 切换动画 */
    transition: opacity 1.2s ease-in-out, transform 1.5s cubic-bezier(0.2, 0.8, 0.2, 1);
    will-change: opacity, transform;
  }

  /* --- 状态切换逻辑 (保持不变) --- */
  .collage-wrapper[data-active-theme='cool'] .group-cool {
    opacity: 1;
    transform: scale(1);
    filter: saturate(0.9) brightness(1.05);
  }
  .collage-wrapper[data-active-theme='cool'] .group-warm {
    opacity: 0;
    transform: scale(1.05) translateY(20px); /* 隐藏时稍微下沉 */
  }

  .collage-wrapper[data-active-theme='cool'] .internal-overlay {
    background: linear-gradient(to bottom, rgba(165, 216, 255, 0.4) 0%, rgba(19, 102, 183, 0.7) 100%);
  }

  .collage-wrapper[data-active-theme='warm'] .group-cool {
    opacity: 0;
    transform: scale(1.05) translateY(-20px); /* 隐藏时稍微上浮 */
  }
  .collage-wrapper[data-active-theme='warm'] .group-warm {
    opacity: 1;
    transform: scale(1);
    filter: sepia(0.2) contrast(1.1);
  }

  .collage-wrapper[data-active-theme='warm'] .internal-overlay {
    background: linear-gradient(to bottom, rgba(255, 210, 150, 0.2) 0%, rgba(139, 58, 24, 0.8) 100%);
  }

  .internal-overlay {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    mix-blend-mode: multiply;
    transition: background 1.2s ease-in-out;
    z-index: 3;
  }

  /* --- 单个图片样式 --- */
  .img-item {
    position: relative; /* 不再是 absolute，而是遵循网格流 */
    width: 100%;
    height: 100%;
    overflow: hidden;
    opacity: 0.85; /* 图片保持一定透明度，让背景色透过来统一色调 */
    border-radius: 4px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15); /* 给每个“商品”加点阴影 */
    transition: transform 0.5s ease;
  }

  .img-item img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* 关键：裁切图片填满格子，保证整齐 */
    display: block;
  }

  /* --- 制造“稍微错杂”的感觉 --- */

  /* 偶数列 (第2列) 下沉一点，制造波浪感 */
  .img-item:nth-child(2),
  .img-item:nth-child(5) {
    transform: translateY(20px); /* 向下偏移 */
    height: 90%; /* 稍微改短一点，增加不规则感 */
    align-self: start;
  }

  /* 奇数列 (第1、3列) 稍微靠上 */
  .img-item:nth-child(1),
  .img-item:nth-child(3),
  .img-item:nth-child(4),
  .img-item:nth-child(6) {
    align-self: end; /* 靠下对齐或靠上对齐，制造错位 */
    height: 95%;
  }

  /* 针对特定格子的微调 (可选) */
  /* 让第3张图稍微窄一点，或者改变宽高比，如果不想要可以删掉 */
  .img-item:nth-child(3) {
    border-radius: 40px 4px 4px 4px; /* 搞点特殊的圆角 */
  }

  /* --- 移动端适配 --- */
  @media (max-width: 768px) {
    .image-group {
      /* 手机上改为 2列 x 3行 */
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 15px;
      padding: 10vh 15px; /* 避开手机顶部导航 */
    }

    /* 手机上去掉复杂的错位，简单点 */
    .img-item:nth-child(odd) {
      transform: translateY(0);
      margin-top: 20px; /* 简单的上下错位 */
    }
    .img-item:nth-child(even) {
      margin-bottom: 20px;
    }
  }
</style>