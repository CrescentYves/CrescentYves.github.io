---
// components/BackgroundCollage.astro
// 注意：这里的 theme 属性只在第一次刷新页面时有效，
// 后续的跳转由于 transition:persist，需要靠下方的 script 来更新状态。
const { theme = 'cool' } = Astro.props;

// 生成图片路径
// Home: 1-6, Works: 7-12
const homeImages = Array.from({ length: 6 }, (_, i) => `/images/work${i + 1}.jpg`);
const worksImages = Array.from({ length: 6 }, (_, i) => `/images/work${i + 7}.jpg`);
---

<div
  id="collage-wrapper"
  class="collage-wrapper"
  data-active-theme={theme}
  transition:persist
>
  <div class="image-group group-cool">
    {homeImages.map((src, index) => (
      <div class={`img-item pos-${index + 1}`}>
        <img src={src} alt="" />
      </div>
    ))}
  </div>

  <div class="image-group group-warm">
    {worksImages.map((src, index) => (
      <div class={`img-item pos-${index + 1}`}>
        <img src={src} alt="" />
      </div>
    ))}
  </div>

  <div class="internal-overlay"></div>
</div>

<script>
  // 监听 Astro 的页面切换事件
  document.addEventListener('astro:page-load', () => {
    const wrapper = document.getElementById('collage-wrapper');

    if (wrapper) {
      // 检查当前路径是否包含 'works'
      const isWorks = window.location.pathname.includes('/works');

      // 动态设置属性，触发 CSS 过渡
      // 如果在 works 页面，设置为 warm；否则设置为 cool
      wrapper.setAttribute('data-active-theme', isWorks ? 'warm' : 'cool');
    }
  });
</script>

<style>
  .collage-wrapper {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
    overflow: hidden;
    pointer-events: none;
  }

  /* 图片组基础样式 */
  .image-group {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* 关键：1.2秒的透明度过渡，实现丝滑叠化 */
    transition: opacity 1.2s ease-in-out, transform 1.5s ease-out;
    will-change: opacity, transform;
  }

  /* --- 状态切换逻辑 --- */

  /* 状态：COOL (首页) */
  .collage-wrapper[data-active-theme='cool'] .group-cool {
    opacity: 1;
    transform: scale(1);
    z-index: 2;
  }
  .collage-wrapper[data-active-theme='cool'] .group-warm {
    opacity: 0;
    transform: scale(1.1); /* 隐藏在后面稍微放大一点 */
    z-index: 1;
  }
  /* 对应的冷色滤镜 */
  .collage-wrapper[data-active-theme='cool'] .internal-overlay {
    background: linear-gradient(to bottom, rgba(165, 216, 255, 0.4) 0%, rgba(19, 102, 183, 0.7) 100%);
  }

  /* 状态：WARM (Works) */
  .collage-wrapper[data-active-theme='warm'] .group-cool {
    opacity: 0;
    transform: scale(1.1);
    z-index: 1;
  }
  .collage-wrapper[data-active-theme='warm'] .group-warm {
    opacity: 1;
    transform: scale(1);
    z-index: 2;
  }
  /* 对应的暖色滤镜 */
  .collage-wrapper[data-active-theme='warm'] .internal-overlay {
    background: linear-gradient(to bottom, rgba(255, 210, 150, 0.3) 0%, rgba(139, 58, 24, 0.8) 100%);
  }

  /* 内置的 Overlay 样式 */
  .internal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    mix-blend-mode: multiply; /* 混合模式 */
    transition: background 1.2s ease-in-out; /* 颜色也要丝滑过渡 */
    z-index: 3;
  }

  /* --- 图片布局 (保持之前的布局) --- */
  .img-item {
    position: absolute;
    opacity: 0.8;
  }
  .img-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 4px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  }

  /* 布局位置定义 */
  .pos-1 { top: -5%; left: -5%; width: 35vw; height: 45vh; }
  .pos-2 { top: 10%; right: -5%; width: 40vw; height: 35vh; }
  .pos-3 { bottom: -10%; left: 5%; width: 20vw; height: 40vh; }
  .pos-4 { bottom: 5%; right: 5%; width: 30vw; height: 45vh; }
  .pos-5 { top: 35%; left: 30%; width: