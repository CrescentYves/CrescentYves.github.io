---
import BaseLayout from '../../layouts/Baselayout.astro';
import { getCollection } from 'astro:content';

// 读取 src/content/works 下的所有 md
const works = await getCollection('works');

// 可选：按日期倒序（如果你 md 里写了 pubDate）
works.sort((a, b) => {
  const da = a.data.pubDate ? new Date(a.data.pubDate).getTime() : 0;
  const db = b.data.pubDate ? new Date(b.data.pubDate).getTime() : 0;
  return db - da;
});
---

<BaseLayout title="Works" description="Selected projects and writings.">
  <main class="container">
    <header class="page-header">
      <h1>Works</h1>
      <p class="subtitle">Selected projects and writings.</p>
    </header>

    {works.length === 0 ? (
      <div class="empty">
        <p>还没有读取到 works 内容。</p>
        <p class="hint">
          请确认：<code>src/content/works/*.md</code> 存在，并且每个文件至少包含
          <code>title</code> 的 frontmatter；同时 <code>src/content/config.ts</code> 里已声明
          <code>works</code> collection。
        </p>
      </div>
    ) : (
      <ul class="grid">
        {works.map((w) => (
          <li class="card">
            <a class="card-link" href={`/works/${w.slug}/`}>
              <h2 class="card-title">{w.data.title}</h2>
              {w.data.description ? (
                <p class="card-desc">{w.data.description}</p>
              ) : (
                <p class="card-desc muted">No description.</p>
              )}

              {w.data.pubDate ? (
                <p class="card-meta">
                  {new Intl.DateTimeFormat('en-US', { dateStyle: 'medium' }).format(
                    new Date(w.data.pubDate)
                  )}
                </p>
              ) : null}
            </a>
          </li>
        ))}
      </ul>
    )}
  </main>
</BaseLayout>

<style>
  .container {
    max-width: 980px;
    margin: 0 auto;
    padding: 48px 16px;
  }

  .page-header {
    margin-bottom: 24px;
  }

  h1 {
    font-size: 2.25rem;
    line-height: 1.15;
    margin: 0 0 8px;
  }

  .subtitle {
    margin: 0;
    color: #666;
    font-size: 1.05rem;
  }

  .empty {
    padding: 20px;
    border: 1px dashed #ccc;
    border-radius: 12px;
  }

  .hint {
    margin-top: 8px;
    color: #666;
    font-size: 0.95rem;
  }

  code {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New",
      monospace;
    font-size: 0.95em;
    background: #f6f6f6;
    padding: 0.1em 0.35em;
    border-radius: 6px;
  }

  .grid {
    list-style: none;
    padding: 0;
    margin: 24px 0 0;
    display: grid;
    gap: 14px;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  }

  .card {
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 14px;
    overflow: hidden;
    background: #fff;
    transition: transform 120ms ease, box-shadow 120ms ease;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 26px rgba(0, 0, 0, 0.08);
  }

  .card-link {
    display: block;
    padding: 16px 16px 14px;
    color: inherit;
    text-decoration: none;
  }

  .card-title {
    margin: 0 0 8px;
    font-size: 1.2rem;
    line-height: 1.25;
  }

  .card-desc {
    margin: 0 0 10px;
    color: #444;
    line-height: 1.45;
  }

  .muted {
    color: #888;
  }

  .card-meta {
    margin: 0;
    color: #777;
    font-size: 0.92rem;
  }
</style>
